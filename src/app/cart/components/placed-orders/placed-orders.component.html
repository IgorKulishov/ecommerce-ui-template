<app-alert [size]="'lg'" [dismissible]="true" [type]="'warning'"></app-alert>
<div class="container-fluid default-page-background">

  <div class="table-block">
    <table class="table text-center">
      <thead>
        <tr>
          <th>{{ 'checkout.image' | translate }}</th>
          <th>{{ 'checkout.product' | translate}}</th>
          <th>{{ 'checkout.price' | translate}}</th>
          <th>{{ 'checkout.quantity' | translate}}</th>
          <th>{{ 'checkout.total' | translate}}</th>
          <th>{{ 'placedOrder.dateOfOrder' | translate }}</th>
          <th>{{ 'placedOrder.cancel' | translate }}</th>
        </tr>
      </thead>

      <!-- fullscreen view -->
      <tbody *ngFor='let placedOrdersDetails of (placedOrdersDetails$ | async)' id="order-block-for-desktop">
        <tr *ngFor='let placedOrderProductsDescription of placedOrdersDetails?.orderDetails.itemList'>
          <td class="align-middle"><img [src]="getProductUrl(placedOrderProductsDescription.product.productInfo)"
            onerror="this.onerror=null;this.src='/assets/images/teapod.jpeg';" alt="image of {{placedOrderProductsDescription.product.name}}"></td>
          <td class="align-middle">{{placedOrderProductsDescription.product.description}}</td>
          <td class="align-middle">$ {{placedOrderProductsDescription.product.price}}</td>
          <td class="align-middle">{{placedOrderProductsDescription.quantity}} {{'placedOrder.pcs' | translate}}</td>
          <td class="align-middle">$ {{ totalSum(placedOrderProductsDescription.product.price, placedOrderProductsDescription.quantity) }}</td>
          <td class="align-middle">{{placedOrdersDetails?.updatedAt | date}}</td>
          <td class="align-middle"><button type="button" class="btn btn-danger" (click)="openModal(orderCancel)">{{ 'placedOrder.cancel' | translate }}</button>          
          </td>
          <!-- Modal window to approve Order cancel -->
          <ng-template #orderCancel>
            <div class="modal-body">
              <div class="text-center modal-body-text">{{'cancelOrderModal.modalBodyText' | translate}}</div><br>
              <div class="text-right">
                <button type="button" class="btn btn-success" aria-label="Close" (click)="modalRef.hide()">
                  <span aria-hidden="true">{{'cancelOrderModal.close' | translate}}</span>
                </button>
                <button type="button" class="btn btn-danger" (click)="deleteOrderFromHistory(placedOrdersDetails?.id)">{{'cancelOrderModal.cancelOrder' | translate}}</button>
              </div>
            </div>
          </ng-template>
          <!-- modal window -->
        </tr>

      </tbody>

      <!-- mobile view -->
      <tbody *ngFor='let placedOrdersDetails of (placedOrdersDetails$ | async); let i = index' id="order-block-for-mobile">
        <accordion [isAnimated]="true">
          <accordion-group>
            <button id="modalBtn" class="btn btn-link" accordion-heading type="button" (click)='changeChevronDirection(i)'>
              {{placedOrdersDetails?.updatedAt | date}}
              <svg [attr.id]="'chevCaretDown'+i" viewBox="0 0 16 16" class="bi bi-caret-down-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
              </svg>
            </button>
            <tr *ngFor='let placedOrderProductsDescription of placedOrdersDetails?.orderDetails.itemList'>
              <td class="align-middle"><img [src]="getProductUrl(placedOrderProductsDescription.product.productInfo)"
                onerror="this.onerror=null;this.src='/assets/images/teapod.jpeg';" alt="image of {{placedOrderProductsDescription.product.name}}"></td>
              <td class="align-middle" [attr.data-label]="'checkout.product' | translate">{{placedOrderProductsDescription.product.description}}</td>
              <td class="align-middle" [attr.data-label]="'checkout.price' | translate">$ {{placedOrderProductsDescription.product.price}}</td>
              <td class="align-middle" [attr.data-label]="'checkout.quantity' | translate">{{placedOrderProductsDescription.quantity}} {{'placedOrder.pcs' | translate}}</td>
              <td class="align-middle" [attr.data-label]="'checkout.total' | translate">$ {{ totalSum(placedOrderProductsDescription.product.price, placedOrderProductsDescription.quantity) }}</td>
              <td class="align-middle" [attr.data-label]="'placedOrder.dateOfOrder' | translate">{{placedOrdersDetails?.updatedAt | date}}</td>
              <td class="align-middle" [attr.data-label]="'placedOrder.cancel' | translate"><button type="button" class="btn btn-danger" (click)="openModal(orderCancel)">{{ 'placedOrder.cancel' | translate }}</button></td>
              <!-- Modal window to approve Order cancel -->
              <ng-template #orderCancel>
                <div class="modal-body">
                  <div class="text-center modal-body-text">{{'cancelOrderModal.modalBodyText' | translate}}</div><br>
                  <div class="text-right">
                    <button type="button" class="btn btn-success" aria-label="Close" (click)="modalRef.hide()">
                      <span aria-hidden="true">{{'cancelOrderModal.close' | translate}}</span>
                    </button>
                    <button type="button" class="btn btn-danger" (click)="deleteOrderFromHistory(placedOrdersDetails?.id)">{{'cancelOrderModal.cancelOrder' | translate}}</button>
                  </div>
                </div>
              </ng-template>
              <!-- modal window -->
            </tr>
          </accordion-group>
        </accordion>
      </tbody>

    </table>
  </div>

  <div class="row justify-content-end pt-5">
    <div class="col-12 col-md-7 col-lg-6 col-xl-5">
      <div class="card">
        <div class="card-body">
          <h3 class="card-title">{{ 'checkout.cartTotals' | translate }}</h3>
          <table class="cart__totals">
            <thead *ngIf="totalAmount" class="cart__totals-header">
            <tr>
              <th>{{ 'checkout.subtotal' | translate }}</th>
              <td>$ {{totalAmount}}</td>
            </tr>
            </thead>
            <tbody *ngIf="totalAmount" class="cart__totals-body">
            </tbody>
            <tfoot class="cart__totals-footer">
            <tr>
              <th>{{ 'checkout.total' | translate }}</th>
              <td>$ {{totalAmount}}</td>
            </tr>
            <tr>
              <th>
              </th>
              <th>
                <div class="text-center checkout-confirmation" *ngIf='checkOutConfirmationStatus'>Thank you! Your order has been accepted!</div>
              </th>
            </tr>
            </tfoot>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
